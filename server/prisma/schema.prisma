// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
    provider = "prisma-client"
    output   = "./generated/"

    generatedFileExtension = "ts"
    importFileExtension    = ""

    moduleFormat = "cjs"
}

datasource db {
    provider = "mongodb"
    url      = env("DATABASE_URL")
}

enum Role {
    User
    Admin
}

enum Unit {
    Gram
    Kilogram
    Other
}

enum OrderStatus {
    Pending
    Confirm
    InTransit
    Done
    Cancled
}

enum OrderPaymentStatus {
    UnPaid
    Paid
}

enum PaymentType {
    Momo
    VNPay
    SeaPay
}

enum CommonStatus {
    Active
    UnActive
    Other
}

model Accounts {
    id       String @id @default(auto()) @map("_id") @db.ObjectId
    email    String @unique
    password String
    role     Role   @default(User)

    cart Carts?

    orders    Orders[]
    addresses Addresses[]

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
    isLock    Boolean  @default(false)
}

model Addresses {
    id        String   @id @default(auto()) @map("_id") @db.ObjectId
    accountId String   @unique @db.ObjectId
    account   Accounts @relation(fields: [accountId], references: [id])
    province  String
    city      String
    home      String
}

model Categories {
    id     String       @id @default(auto()) @map("_id") @db.ObjectId
    name   String
    status CommonStatus @default(Other)
    slug   String       @unique

    products Products[]

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
    isDelete  Boolean  @default(false)
}

model Tags {
    id     String       @id @default(auto()) @map("_id") @db.ObjectId
    name   String
    status CommonStatus @default(Other)

    tagItems TagProducts[]

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
    isDelete  Boolean  @default(false)
}

model Properties {
    id          String   @id @default(auto()) @map("_id") @db.ObjectId
    productId   String   @unique @db.ObjectId
    Product     Products @relation(fields: [productId], references: [id])
    urlImage    String
    name        String
    description String
    weight      String
    unit        Unit     @default(Other)
    length      Int
    width       Int
    height      Int

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
}

model Products {
    id           String       @id @default(auto()) @map("_id") @db.ObjectId
    currentStock Int          @default(0)
    price        Int
    status       CommonStatus @default(Other)

    categoryId String     @db.ObjectId
    category   Categories @relation(fields: [categoryId], references: [id])

    isDelete Boolean @default(false)

    tagItems TagProducts[]

    orderItems OrderItems[]

    cartItems CartItems[]

    property Properties?
}

model Orders {
    id            String             @id @default(auto()) @map("_id") @db.ObjectId
    totalAmount   Int
    name          String
    phone         String
    email         String?
    address       String
    note          String
    status        OrderStatus        @default(Pending)
    paymentStatus OrderPaymentStatus @default(UnPaid)

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    accountId String   @db.ObjectId
    account   Accounts @relation(fields: [accountId], references: [id])

    orderItems OrderItems[]
    payment    Payments?
}

model OrderItems {
    id       String @id @default(auto()) @map("_id") @db.ObjectId
    quantity Int
    price    Int

    orderId String @db.ObjectId
    order   Orders @relation(fields: [orderId], references: [id])

    productId String   @db.ObjectId
    product   Products @relation(fields: [productId], references: [id])
}

model TagProducts {
    id String @id @default(auto()) @map("_id") @db.ObjectId

    tagId String @db.ObjectId
    tag   Tags   @relation(fields: [tagId], references: [id])

    productId String   @db.ObjectId
    product   Products @relation(fields: [productId], references: [id])
}

model Payments {
    id            String      @id @default(auto()) @map("_id") @db.ObjectId
    type          PaymentType
    transactionId String
    totalAmount   Int
    content       String
    status        String
    createAt      DateTime    @default(now())

    orderId String @unique @db.ObjectId
    order   Orders @relation(fields: [orderId], references: [id])
}

model Carts {
    id String @id @default(auto()) @map("_id") @db.ObjectId

    accountId String   @unique @db.ObjectId
    account   Accounts @relation(fields: [accountId], references: [id])

    cartItems CartItems[]
}

model CartItems {
    id       String @id @default(auto()) @map("_id") @db.ObjectId
    quantity Int

    productId String   @db.ObjectId
    product   Products @relation(fields: [productId], references: [id])

    cartId String @db.ObjectId
    cart   Carts  @relation(fields: [cartId], references: [id])
}
